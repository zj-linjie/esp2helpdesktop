# JC3636W518C 上板调研与点亮记录（2026-02-27）

## 1. 目标

- 在 macOS 上识别并连接 ESP32-S3 设备
- 备份设备预装固件
- 将当前项目固件烧录到硬件并点亮 360x360 圆屏
- 验证与 Electron WebSocket 后端联通

## 2. 关键结论（TL;DR）

- 屏幕已点亮，显示 `ESP32 Desktop`，后端通信正常。
- 黑屏根因不是 LVGL 逻辑本身，而是**板型引脚映射错误**：
  - 最初按 `JC3636K518` 映射配置，触摸 I2C 初始化失败，屏幕一直黑。
  - 切换到 `JC3636W518C` 映射后，触摸与显示初始化都成功。
- 当前固件与后端已可联调，具备继续把业务页面迁移到 ESP32 的基础条件。

## 3. 现场验证记录

### 3.1 串口与后端可达性

- 串口设备：`/dev/cu.usbmodem21101`
- WebSocket 服务端端口：`8765`
- 设备握手与收包正常（`handshake_ack`、`system_stats` 持续收到）

### 3.2 预装系统备份

- 备份目录：`/Users/apple/dev/esp2helpdesktop/backups/esp32_preinstall_20260227_175918/`
- 包含：
  - `full_16MB.bin`
  - `app0_0x10000.bin`
  - `app1_0x310000.bin`
  - `spiffs_0x610000_0x9e0000.bin`
  - `chunks/chunk_*.bin`

### 3.3 启动日志证据（切到 W518C 映射后）

- 关键日志：
  - `[LCD] init start`
  - `begin return = 1`
  - `IC id: 182`
  - `[LCD] touch init=1 begin=1 ready=1`
  - `[LCD] init done`
  - `WiFi connected`
  - `Connecting WebSocket: 192.168.50.100:8765`
  - `[WebSocket] connected`

## 4. 黑屏问题根因与修复

### 4.1 根因

- 前期使用的引脚配置来自 `K518` 资料，不适配当前 `JC3636W518C` 实际硬件。
- 直接表现：
  - 触摸控制器 `CST816` I2C 读版本失败（`begin=0`）
  - 显示无输出（全黑）

### 4.2 已完成修复

- 切换到 `W518C` 映射（参考公开仓库）：
  - 参考：`https://github.com/moononournation/JC3636W518`
- 更新文件：
  - `esp32-firmware/src/display/pincfg.h`
- 当前有效引脚：
  - 背光 `BL=15`
  - LCD QSPI：`CS=10, SCK=9, D0=11, D1=12, D2=13, D3=14, RST=47`
  - 触摸 I2C：`SDA=7, SCL=8, RST=40, INT=41`

### 4.3 构建与工具链修复

- 为避免本机 Python 3.14 与 PlatformIO 依赖冲突，创建了本地虚拟环境：
  - `esp32-firmware/.venv-pio312`（Python 3.12）
- `platformio.ini` 调整为 Arduino 3.1.1 兼容栈，并固定显示面板依赖版本。
- 补充 `-Iinclude`，确保 `lv_conf.h` 生效。

## 5. “项目代码能不能整上去”评估

结论：**可以整上去，但不是把 Electron/React 代码直接塞进 ESP32；需要按“协议复用 + UI重写 + 业务逐页迁移”的方式推进。**

### 5.1 可以直接复用的部分

- WebSocket 协议与消息结构（`handshake` / `heartbeat` / `system_stats`）
- 后端系统数据采集与广播机制（Electron 主进程）
- 业务状态流转逻辑（页面状态机思路）

### 5.2 不能直接复用的部分

- `electron-app/src/renderer` 下 React + MUI 组件不能直接运行在 ESP32
- Web 端 CSS/DOM 动画不能直接迁移到 LVGL，需要重写为 LVGL 对象和动画

### 5.3 可执行迁移路径（建议）

1. **阶段A：稳定基础通信与导航**
   - 固化当前首页（已完成）
   - 加入触摸导航（主页 -> 子页 -> 返回）
2. **阶段B：先迁移低依赖页面**
   - 时钟页、系统监控页（最容易，依赖少）
3. **阶段C：再迁移中等复杂页面**
   - 番茄钟、快捷设置
4. **阶段D：最后迁移高依赖页面**
   - 电子相框（存储/图片解码）
   - 天气（API与缓存）
   - 语音/AI（资源和延迟约束更高）

## 6. 当前状态（可作为后续开发基线）

- 硬件：已可正常点亮并显示文本 UI
- 触摸：初始化成功（`ready=1`）
- 网络：WiFi 正常连接
- 后端：WebSocket 正常握手与数据收发
- 代码基线：
  - `esp32-firmware/src/display/pincfg.h`（W518C 映射）
  - `esp32-firmware/src/display/scr_st77916.h`（显示初始化 + 自检打印）
  - `esp32-firmware/src/main.cpp`（基础 UI + WebSocket）

## 7. 下一步建议

- 先把“触摸页切换 + 返回手势”做掉，建立真实硬件上的页面框架。
- 然后按“时钟 -> 系统监控 -> 番茄钟”顺序迁移，保证每一步都可在设备上验收。
