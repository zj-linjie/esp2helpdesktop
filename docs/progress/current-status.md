# ESP32-S3 智能桌面助手 - 项目进度文档

**文档版本**: v1.1
**更新日期**: 2026-02-17
**当前版本**: v0.3.0
**项目状态**: 核心功能开发中，Web 模拟器功能完善

---

## 📊 项目概览

### 项目目标
开发一个基于 ESP32-S3R8 的圆形智能桌面助手系统，采用 1.8 寸 360×360 高清圆形触控屏幕和 QI 无线充电，集成电子相框、天气、时钟、语音控制、本地 AI、系统监控、番茄钟等功能。

### 技术架构
- **ESP32 端**: Arduino + LVGL + TensorFlow Lite Micro
- **Electron 端**: React 18 + TypeScript + Material-UI + WebSocket
- **通信协议**: WebSocket (JSON)
- **开发模式**: Subagent-Driven Development + Superpowers 工作流

### 硬件规格
- **主控**: ESP32-S3R8 (双核 240MHz, 8MB PSRAM, 16MB Flash)
- **屏幕**: 1.8 寸圆形 LCD, 360×360 分辨率, 电容触控
- **音频**: I2S 数字麦克风 + I2S DAC
- **存储**: TF 卡接口
- **电源**: QI 无线充电

---

## ✅ 已完成功能

### 阶段 1-2: 项目基础搭建和系统信息采集 (100%)

#### Electron 应用
- ✅ **项目初始化**
  - Electron 40.x + React 18 + TypeScript
  - Vite 构建配置
  - Material-UI v7 深色主题
  - 开发环境配置完成

- ✅ **WebSocket 服务器**
  - 监听端口 8765
  - 客户端连接管理
  - 握手协议处理
  - 消息发送和广播
  - 自动重连机制

- ✅ **系统信息采集模块**
  - CPU 使用率实时采集
  - 内存使用情况（已用/总量/百分比）
  - 网络速度计算（上传/下载）
  - 每秒自动推送到客户端
  - 使用 systeminformation 库

- ✅ **控制中心界面**
  - 系统监控卡片（CPU、内存、网络）
  - 性能趋势图表（30 秒历史数据，使用 Recharts）
  - WebSocket 连接状态显示
  - 消息日志面板（最近 50 条）
  - 设备列表管理
  - 标签页切换（控制中心/设备模拟器）

#### ESP32 Web 模拟器
- ✅ **圆形屏幕模拟**
  - 360×360 像素圆形显示
  - CSS clip-path 圆形裁剪
  - 黑色背景，模拟真实硬件
  - 触控交互支持

- ✅ **圆形导航盘**
  - 中心显示实时时间和日期
  - 8 个功能图标环形排列：
    * 📷 电子相框
    * 🌤️ 天气
    * 🕐 时钟
    * 🎤 语音
    * 🤖 AI 助手
    * 📊 系统监控
    * 🍅 番茄钟
    * ⚡ 快捷控制
  - 渐变色按钮设计
  - 悬停和点击动画效果
  - 图标按圆形均匀分布

- ✅ **系统监控页面**
  - 圆形进度环显示 CPU 使用率
  - 圆形进度环显示内存使用率
  - 网络速度显示（上传/下载）
  - 接收真实系统数据
  - SVG 动态进度条

- ✅ **时钟页面**
  - 大字体实时时钟显示
  - 日期和星期显示
  - 每秒自动更新
  - 简洁的圆形布局

- ✅ **返回导航功能**
  - 长按屏幕中心返回（800ms）
  - 所有页面统一交互方式

- ✅ **番茄钟页面**
  - 三种模式：工作（25分钟）、短休息（5分钟）、长休息（15分钟）
  - 圆形进度环显示倒计时
  - 扇形交互区域（符合圆形屏幕设计）：
    * 左扇形（200-240°）：重置
    * 中扇形（160-200°）：开始/暂停
    * 右扇形（120-160°）：跳过
  - 有效触控距离：100-160px
  - 不同模式渐变色背景（红/绿/蓝）
  - 音频提示（Web Audio API）
  - 番茄钟计数统计
  - 自动循环：4个工作周期后长休息

- ✅ **圆形屏幕设计规范**
  - 创建完整设计指南文档
  - 定义安全区域（半径 160px）和核心区域（半径 120px）
  - 所有页面遵循圆形布局原则
  - 避免边缘按钮和方形布局
  - 支持鼠标和触摸事件
  - 流畅的动画效果

- ✅ **天气页面**
  - 集成和风天气 API（支持免费版端点）
  - 根据天气状况动态背景渐变（晴天/雨天/雪天等）
  - 大温度显示 + 天气图标动画
  - 点击城市名快速切换城市
  - 显示体感温度、湿度等详细信息
  - 每30分钟自动更新
  - 2小时智能缓存机制（减少API调用90%）
  - 预加载所有城市天气（并发请求）
  - 长按屏幕返回

- ✅ **城市管理系统**
  - 支持添加/删除多个城市
  - 至少保留一个城市的保护机制
  - 本地存储配置（localStorage）
  - 城市切换立即生效（从缓存读取）
  - 预留 ESP32 配网接口（WebSocket 同步）

- ✅ **设置标签页**
  - 和风天气 API Key 配置
  - 城市列表管理界面
  - 密码输入框（可显示/隐藏）
  - 保存成功提示
  - 精美的 Material-UI 设计
  - 流畅的动画效果

#### ESP32-S3 固件
- ✅ **项目初始化**
  - PlatformIO 配置（8MB PSRAM 支持）
  - Arduino 框架
  - 库依赖配置（ArduinoJson, WebSockets, LVGL）

- ✅ **WiFi 连接**
  - 自动连接 WiFi
  - 连接状态显示
  - IP 地址获取

- ✅ **WebSocket 客户端**
  - 连接到 Electron 服务器
  - 握手消息发送
  - 消息接收和 JSON 解析
  - 心跳包发送（每 5 秒）
  - 自动重连机制

- ✅ **系统信息接收**
  - 解析系统信息 JSON
  - 串口输出格式化数据
  - 实时数据显示

#### 开发工具和文档
- ✅ **测试客户端**
  - WebSocket 测试客户端（test-client.js）
  - 模拟 ESP32 设备连接
  - 接收和显示系统信息
  - 发送心跳包

- ✅ **项目文档**
  - 完整的 README.md
  - 详细的实施计划（docs/plans/2026-02-15-esp32-desktop-assistant.md）
  - 一键启动脚本（start.sh）
  - .gitignore 配置

- ✅ **Git 仓库**
  - GitHub 仓库：https://github.com/crazyjgg7/esp2helpdesktop
  - 代码已推送
  - 排除 node_modules 和构建文件

---

## 🔄 进行中的功能

### 当前无进行中的功能
所有已启动的功能都已完成。

---

## 📋 待开发功能

### 阶段 3: LVGL UI 开发（真实硬件）- 预计 2-3 周

#### 3.1 LVGL 环境配置
- [ ] 配置 LVGL 8.3+ 库
- [ ] 配置 360×360 圆形屏幕驱动
- [ ] 配置电容触控驱动
- [ ] 测试 PSRAM 帧缓冲
- [ ] 优化渲染性能

#### 3.2 圆形导航盘实现
- [ ] 使用 LVGL 实现圆形容器
- [ ] 绘制 8 个功能图标（环形排列）
- [ ] 实现触控事件处理
- [ ] 中心时间显示
- [ ] 页面切换动画
- [ ] 长按返回手势

#### 3.3 系统监控页面
- [ ] 使用 LVGL Arc 组件绘制圆形进度环
- [ ] CPU 使用率显示
- [ ] 内存使用率显示
- [ ] 网络速度显示
- [ ] 实时数据更新
- [ ] 返回按钮

#### 3.4 时钟页面
- [ ] 大字体时间显示
- [ ] 日期和星期显示
- [ ] 实时更新（每秒）
- [ ] 圆形布局适配

---

### 阶段 4: 电子相框功能 - 预计 2-3 周

#### 4.1 TF 卡和照片管理
- [ ] TF 卡挂载和检测
- [ ] 照片文件扫描（JPEG/PNG）
- [ ] 照片列表管理
- [ ] 文件夹分类支持

#### 4.2 照片显示和解码
- [ ] JPEG 解码（TJpg_Decoder）
- [ ] PNG 解码（PNGdec）
- [ ] 照片缩放和裁剪（适配圆形屏幕）
- [ ] PSRAM 缓冲管理
- [ ] 照片预加载

#### 4.3 轮播功能
- [ ] 自动轮播（可设置间隔）
- [ ] 手动切换（上一张/下一张）
- [ ] 切换动画（淡入淡出/滑动）
- [ ] 暂停/继续轮播
- [ ] 照片信息显示（日期、位置）

#### 4.4 Electron 照片管理工具
- [ ] 照片上传界面
- [ ] 批量上传功能
- [ ] 照片预览
- [ ] 照片删除
- [ ] 照片分类管理
- [ ] 通过 WebSocket 推送到 ESP32

---

### 阶段 5: 天气功能 - 预计 1-2 周

#### 5.1 天气 API 集成
- [ ] 选择天气 API（和风天气/OpenWeatherMap）
- [ ] API 密钥配置
- [ ] 天气数据获取
- [ ] 定时更新（每 30 分钟）
- [ ] 多城市支持

#### 5.2 天气数据推送
- [ ] 定义天气数据协议
- [ ] 通过 WebSocket 推送到 ESP32
- [ ] 数据缓存机制
- [ ] 离线数据显示

#### 5.3 天气 UI 实现
- [ ] 当前温度显示（大字体）
- [ ] 天气图标（晴/阴/雨/雪等）
- [ ] 体感温度、湿度、风速
- [ ] 空气质量指数（AQI）
- [ ] 未来 3 天天气预报
- [ ] 天气动画效果（雨滴、雪花等）

#### 5.4 Electron 天气配置
- [ ] 城市选择界面
- [ ] API 密钥配置
- [ ] 更新频率设置
- [ ] 天气数据预览

---

### 阶段 6: 番茄钟功能 - 预计 1-2 周

#### 6.1 番茄钟逻辑
- [ ] 倒计时功能（25 分钟工作）
- [ ] 短休息（5 分钟）
- [ ] 长休息（15 分钟）
- [ ] 自动切换模式
- [ ] 完成次数统计
- [ ] 本地存储统计数据

#### 6.2 番茄钟 UI
- [ ] 圆形倒计时显示
- [ ] 环形进度条（不同颜色表示不同模式）
- [ ] 开始/暂停/重置按钮
- [ ] 完成次数显示
- [ ] 下一个模式提示

#### 6.3 音频提醒
- [ ] I2S DAC 音频播放
- [ ] 提醒音文件（工作结束/休息结束）
- [ ] 音量控制
- [ ] 提醒音选择

#### 6.4 Electron 番茄钟管理
- [ ] 时长自定义（15/25/45 分钟）
- [ ] 休息时长设置
- [ ] 提醒音选择
- [ ] 统计数据显示（每日/每周）
- [ ] 统计图表

---

### 阶段 7: 语音控制 - 预计 2-3 周

#### 7.1 I2S 麦克风录音
- [ ] I2S 麦克风驱动配置
- [ ] 音频采样（16kHz）
- [ ] 音频缓冲管理
- [ ] 录音触发机制

#### 7.2 语音数据上传
- [ ] 音频数据编码
- [ ] 通过 WebSocket 上传到 Electron
- [ ] 分块传输（避免内存溢出）
- [ ] 传输进度显示

#### 7.3 Electron 语音识别
- [ ] 集成 Whisper API（OpenAI）
- [ ] 或集成百度/讯飞语音识别
- [ ] 或本地 Whisper.cpp
- [ ] 语音转文字
- [ ] 识别结果返回

#### 7.4 命令解析和执行
- [ ] 命令意图识别
- [ ] 参数提取
- [ ] 命令执行（打开应用、控制功能等）
- [ ] 执行结果反馈

#### 7.5 TTS 语音反馈
- [ ] macOS 原生 TTS（say 命令）
- [ ] 或 Google Cloud TTS
- [ ] 音频流式传输到 ESP32
- [ ] I2S DAC 播放

#### 7.6 语音控制 UI
- [ ] 语音唤醒界面
- [ ] 波形动画显示
- [ ] 识别中状态显示
- [ ] 识别结果显示
- [ ] 错误提示

---

### 阶段 8: 本地 AI 集成 - 预计 3-4 周

#### 8.1 AI 框架选择和集成
- [ ] 评估 TensorFlow Lite Micro
- [ ] 评估 ESP-SR（乐鑫语音识别）
- [ ] 评估 Edge Impulse
- [ ] 选择最适合的方案
- [ ] 集成到项目

#### 8.2 唤醒词模型
- [ ] 收集训练数据（"你好助手"等）
- [ ] 训练唤醒词模型
- [ ] 模型量化（INT8）
- [ ] 转换为 TFLite 格式
- [ ] 部署到 ESP32 Flash/PSRAM
- [ ] 测试准确率和响应速度

#### 8.3 命令识别模型
- [ ] 定义 20-30 个常用命令
- [ ] 收集训练数据
- [ ] 训练命令识别模型
- [ ] 模型量化和优化
- [ ] 部署到 ESP32
- [ ] 测试识别准确率

#### 8.4 场景分类模型
- [ ] 定义场景类型（工作/休息/娱乐等）
- [ ] 收集使用数据
- [ ] 训练场景分类模型
- [ ] 智能推荐功能
- [ ] 自动切换页面

#### 8.5 AI 推理优化
- [ ] 使用 PSRAM 存储模型
- [ ] 双核并行（核心 1 处理 AI）
- [ ] 缓存推理结果
- [ ] 动态加载模型
- [ ] 性能测试和优化

#### 8.6 本地 AI + 云端 AI 混合
- [ ] 简单命令本地处理
- [ ] 复杂命令云端处理
- [ ] 智能路由逻辑
- [ ] 离线模式支持

---

### 阶段 9: 其他功能页面 - 预计 1-2 周

#### 9.1 快捷控制页面
- [ ] 音量控制（圆形滑动条）
- [ ] 屏幕亮度控制
- [ ] 自定义快捷按钮（4-6 个）
- [ ] 按钮图标和名称配置
- [ ] 触发 macOS 脚本/命令

#### 9.2 设置页面
- [ ] WiFi 配置
- [ ] WebSocket 服务器配置
- [ ] 屏幕亮度设置
- [ ] 音量设置
- [ ] 关于设备信息
- [ ] 固件版本显示

---

### 阶段 10: 测试和优化 - 预计 2-3 周

#### 10.1 功能测试
- [ ] 所有功能模块测试
- [ ] 页面切换测试
- [ ] 触控响应测试
- [ ] WebSocket 通信测试
- [ ] 断线重连测试

#### 10.2 性能优化
- [ ] 内存使用优化
- [ ] 渲染性能优化
- [ ] 网络延迟优化
- [ ] 功耗优化
- [ ] 启动速度优化

#### 10.3 UI/UX 优化
- [ ] 圆形 UI 适配优化
- [ ] 触控精度调优
- [ ] 动画流畅度优化
- [ ] 视觉反馈优化
- [ ] 用户体验测试

#### 10.4 稳定性测试
- [ ] 长时间运行测试（24 小时+）
- [ ] 内存泄漏检测
- [ ] 异常情况处理
- [ ] 错误恢复机制
- [ ] 日志记录

#### 10.5 文档完善
- [ ] 用户手册
- [ ] 开发文档
- [ ] API 文档
- [ ] 故障排查指南
- [ ] 视频演示

---

## 🎯 开发优先级

### 高优先级（建议下一步开发）
1. **阶段 3: LVGL UI 开发** - 真实硬件基础
2. **阶段 6: 番茄钟功能** - 独立功能，易于实现
3. **阶段 5: 天气功能** - 实用功能，API 集成

### 中优先级
4. **阶段 4: 电子相框功能** - 需要 TF 卡和图片处理
5. **阶段 9: 其他功能页面** - 完善基础功能

### 低优先级（后期开发）
6. **阶段 7: 语音控制** - 复杂度高，依赖多
7. **阶段 8: 本地 AI 集成** - 最复杂，需要模型训练

---

## 📁 项目文件结构

```
esp2helpdesktop/
├── .agent/                          # Superpowers 技能和工作流
│   ├── skills/                      # 开发技能
│   ├── workflows/                   # 工作流定义
│   └── rules/                       # 开发规则
├── electron-app/                    # Electron 桌面应用
│   ├── src/
│   │   ├── main/                   # 主进程
│   │   │   ├── index.ts           # ✅ 主进程入口
│   │   │   ├── websocket.ts       # ✅ WebSocket 服务器
│   │   │   └── system.ts          # ✅ 系统信息采集
│   │   └── renderer/               # 渲染进程
│   │       ├── App.tsx            # ✅ 主应用
│   │       └── components/
│   │           ├── SystemMonitor.tsx      # ✅ 系统监控组件
│   │           ├── ConnectionStatus.tsx   # ✅ 连接状态
│   │           ├── MessageLog.tsx         # ✅ 消息日志
│   │           ├── DeviceList.tsx         # ✅ 设备列表
│   │           ├── ESP32Simulator.tsx     # ✅ 模拟器容器
│   │           └── simulator/
│   │               ├── CircularScreen.tsx      # ✅ 圆形屏幕
│   │               ├── NavigationDial.tsx      # ✅ 导航盘
│   │               ├── SystemMonitorPage.tsx   # ✅ 监控页面
│   │               └── ClockPage.tsx           # ✅ 时钟页面
│   ├── package.json               # ✅ 依赖配置
│   ├── tsconfig.json              # ✅ TypeScript 配置
│   └── vite.config.ts             # ✅ Vite 配置
├── esp32-firmware/                  # ESP32-S3 固件
│   ├── src/
│   │   ├── main.cpp               # ✅ 主程序
│   │   └── config.h               # ✅ 配置文件
│   └── platformio.ini             # ✅ PlatformIO 配置
├── docs/
│   ├── plans/                      # 实施计划
│   │   └── 2026-02-15-esp32-desktop-assistant.md  # ✅ 详细计划
│   └── progress/                   # 进度文档
│       └── current-status.md       # ✅ 本文档
├── test-client.js                   # ✅ WebSocket 测试客户端
├── start.sh                         # ✅ 一键启动脚本
├── .gitignore                       # ✅ Git 忽略配置
├── package.json                     # ✅ 根目录依赖
└── README.md                        # ✅ 项目文档
```

---

## 🔧 开发环境

### 已安装的工具
- ✅ Node.js 18+
- ✅ npm
- ✅ Git
- ✅ Electron 40.x
- ✅ Vite
- ✅ TypeScript

### 需要安装的工具（用于硬件开发）
- [ ] PlatformIO CLI (`pip install platformio`)
- [ ] Arduino IDE 2.x（可选）
- [ ] Python 3.x（用于 PlatformIO）

### 开发命令

```bash
# 启动 Electron 应用
cd electron-app
npm start

# 或使用一键启动脚本
./start.sh

# 测试 WebSocket 通信
node test-client.js

# 编译 ESP32 固件（需要 PlatformIO）
cd esp32-firmware
pio run

# 烧录到硬件
pio run --target upload

# 监控串口
pio device monitor
```

---

## 📝 开发注意事项

### 代码规范
- 使用 TypeScript 严格模式
- 遵循 ESLint 规则
- 组件使用函数式组件 + Hooks
- 使用 Material-UI 组件库
- CSS 使用 sx prop 或 styled-components

### Git 提交规范
- `feat:` 新功能
- `fix:` 修复 bug
- `docs:` 文档更新
- `style:` 代码格式调整
- `refactor:` 重构
- `test:` 测试相关
- `chore:` 构建/工具相关

### WebSocket 协议
- 所有消息使用 JSON 格式
- 必须包含 `type` 字段
- 数据放在 `data` 字段中
- 参考 `docs/plans/2026-02-15-esp32-desktop-assistant.md` 中的协议定义

### LVGL 开发注意事项
- 使用 LVGL 8.3+ 版本
- 利用 8MB PSRAM 作为帧缓冲
- 使用双缓冲减少闪烁
- 仅更新变化区域（脏矩形）
- 圆形屏幕使用 clip-path 或 LVGL 圆形容器

---

## 🐛 已知问题

### 当前无已知问题
所有已实现的功能都正常工作。

---

## 💡 未来改进建议

### 功能增强
- [ ] 支持多设备连接
- [ ] 设备分组管理
- [ ] 远程配置更新
- [ ] OTA 固件更新
- [ ] 数据同步到云端
- [ ] 移动端控制应用

### 性能优化
- [ ] WebSocket 消息压缩
- [ ] 图片懒加载
- [ ] 虚拟滚动列表
- [ ] 代码分割（Code Splitting）
- [ ] Service Worker 缓存

### 用户体验
- [ ] 主题切换（浅色/深色）
- [ ] 多语言支持
- [ ] 自定义布局
- [ ] 快捷键支持
- [ ] 拖拽排序

---

## 📞 联系方式

- **GitHub**: https://github.com/crazyjgg7/esp2helpdesktop
- **项目文档**: README.md
- **实施计划**: docs/plans/2026-02-15-esp32-desktop-assistant.md

---

## 📅 版本历史

### v0.2.0 (2026-02-16)
- ✅ 完成 Electron 控制面板
- ✅ 完成 ESP32 Web 模拟器
- ✅ 实现圆形导航盘（8 个功能图标）
- ✅ 实现系统监控页面
- ✅ 实现时钟页面
- ✅ 添加返回导航功能（按钮 + 长按手势）
- ✅ 推送代码到 GitHub

### v0.1.0 (2026-02-15)
- ✅ 完成阶段 1-2：项目基础搭建和系统信息采集
- ✅ Electron + React + TypeScript 项目初始化
- ✅ WebSocket 服务器实现
- ✅ ESP32-S3 固件项目初始化
- ✅ 端到端通信测试

---

## 🎯 下一步行动

### 立即可做（无需硬件）
1. **完善 Web 模拟器其他页面**
   - 电子相框页面（模拟照片轮播）
   - 天气页面（使用模拟数据）
   - 番茄钟页面（完整倒计时功能）
   - 快捷控制页面

2. **Electron 功能增强**
   - 天气 API 集成
   - 番茄钟统计功能
   - 照片管理界面
   - 设置面板

### 需要硬件后开发
3. **LVGL UI 移植**
   - 将 Web 模拟器的 UI 移植到 LVGL
   - 真实硬件测试

4. **硬件功能开发**
   - I2S 音频
   - TF 卡读取
   - 触控优化
   - 本地 AI

---

**文档结束**

*此文档将持续更新，记录项目的最新进度和状态。*
